<!DOCTYPE html>  <html> <head>   <title>jquery.soliloquy.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               jquery.soliloquy.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p><strong>Soliloquy</strong> is a jQuery plugin for aggregating posts from many data sources</p>

<pre><code>Copyright (c) 2011 Trevor C. Hartman
Released under MIT License
http://github.com/devth/soliloquy
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Crockford's <a href="http://javascript.crockford.com/remedial.html">supplant</a></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nb">String</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">supplant</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span> 
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/{([^{}]*)}/g</span><span class="p">,</span>
      <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">o</span><span class="p">[</span><span class="nx">b</span><span class="p">];</span>
        <span class="k">return</span> <span class="k">typeof</span> <span class="nx">r</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">r</span> <span class="o">===</span> <span class="s1">&#39;number&#39;</span> <span class="o">?</span> <span class="nx">r</span> <span class="o">:</span> <span class="nx">a</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>Soliloquy's public interface</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">jQuery</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">soliloquy</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">slq</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Save a reference to the jQuery object to work on</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">jq</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Helper to build public interface for each <code>solo</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">soloInterface</span><span class="p">(</span><span class="nx">soloName</span><span class="p">,</span> <span class="nx">solo</span><span class="p">){</span>
      <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">settings</span> <span class="o">=</span> <span class="nx">prepareSettings</span><span class="p">(</span><span class="nx">solo</span><span class="p">.</span><span class="nx">options</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">solo</span><span class="p">.</span><span class="nx">settings</span><span class="p">);</span>
        <span class="nx">apiCall</span><span class="p">(</span><span class="nx">settings</span><span class="p">,</span> <span class="nx">jq</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Return the jQuery object to provide chaining</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span> <span class="nx">jq</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">publicMethods</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Dynamically build public methods by looping through the solos data structure
and using the <code>soloInterface</code> helper to build a scope over each <code>solo</code>'s unique
<code>settings</code> object. </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="p">(</span><span class="nx">soloName</span> <span class="k">in</span> <span class="nx">solos</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">solo</span> <span class="o">=</span> <span class="nx">solos</span><span class="p">[</span><span class="nx">soloName</span><span class="p">];</span>
      <span class="nx">publicMethods</span><span class="p">[</span><span class="nx">soloName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">soloInterface</span><span class="p">(</span><span class="nx">soloName</span><span class="p">,</span> <span class="nx">solo</span><span class="p">);</span>
    <span class="p">}</span>


    <span class="k">return</span> <span class="nx">publicMethods</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h2>Helpers</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">linkUrl</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">returning</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="kd">var</span> <span class="nx">regexp</span> <span class="o">=</span> <span class="sr">/((ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&amp;%@!\-\/]))?)/gi</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">returning</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">regexp</span><span class="p">,</span><span class="s2">&quot;&lt;a href=\&quot;$1\&quot;&gt;$1&lt;/a&gt;&quot;</span><span class="p">));</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="nx">returning</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">linkUser</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">returning</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="kd">var</span> <span class="nx">regexp</span> <span class="o">=</span> <span class="sr">/[\@]+([A-Za-z0-9-_]+)/gi</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">returning</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">regexp</span><span class="p">,</span><span class="s2">&quot;&lt;a href=\&quot;http://twitter.com/$1\&quot;&gt;@$1&lt;/a&gt;&quot;</span><span class="p">));</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="nx">returning</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">linkHash</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">returning</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="kd">var</span> <span class="nx">regexp</span> <span class="o">=</span> <span class="sr">/ [\#]+([A-Za-z0-9-_]+)/gi</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">returning</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">regexp</span><span class="p">,</span> <span class="s1">&#39; &lt;a href=&quot;http://search.twitter.com/search?q=&amp;tag=$1&amp;lang=all&quot;&gt;#$1&lt;/a&gt;&#39;</span><span class="p">));</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="nx">returning</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="kd">function</span> <span class="nx">processPost</span><span class="p">(</span><span class="nx">postText</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$</span><span class="p">([</span> <span class="nx">postText</span> <span class="p">]).</span><span class="nx">linkUrl</span><span class="p">().</span><span class="nx">linkUser</span><span class="p">().</span><span class="nx">linkHash</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">buildDateString</span><span class="p">(</span><span class="nx">parsedDate</span><span class="p">,</span> <span class="nx">relative</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">relative</span><span class="p">)</span> <span class="k">return</span> <span class="nx">relativeTime</span><span class="p">(</span><span class="nx">parsedDate</span><span class="p">);</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">localOffset</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTimezoneOffset</span><span class="p">()</span> <span class="o">*</span> <span class="mi">60000</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">dateTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">parsedDate</span> <span class="o">-</span> <span class="nx">localOffset</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">minutes</span><span class="p">,</span> <span class="nx">hours</span><span class="p">,</span> <span class="nx">ampm</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">dateTime</span><span class="p">.</span><span class="nx">getHours</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">){</span>
        <span class="nx">hours</span> <span class="o">=</span> <span class="p">(</span><span class="nx">dateTime</span><span class="p">.</span><span class="nx">getHours</span><span class="p">())</span> <span class="o">-</span> <span class="mi">12</span><span class="p">;</span>
        <span class="nx">ampm</span> <span class="o">=</span> <span class="s2">&quot;pm&quot;</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">hours</span> <span class="o">=</span> <span class="p">(</span><span class="nx">dateTime</span><span class="p">.</span><span class="nx">getHours</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="mi">12</span> <span class="o">:</span> <span class="nx">dateTime</span><span class="p">.</span><span class="nx">getHours</span><span class="p">();</span>
        <span class="nx">ampm</span> <span class="o">=</span> <span class="s2">&quot;am&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">minutes</span> <span class="o">=</span> <span class="p">(</span><span class="nx">dateTime</span><span class="p">.</span><span class="nx">getMinutes</span><span class="p">().</span><span class="nx">toString</span><span class="p">().</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;0&quot;</span> <span class="o">+</span> <span class="nx">dateTime</span><span class="p">.</span><span class="nx">getMinutes</span><span class="p">()</span> <span class="o">:</span> <span class="nx">dateTime</span><span class="p">.</span><span class="nx">getMinutes</span><span class="p">();</span>
      <span class="k">return</span> <span class="p">((</span><span class="nx">dateTime</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">dateTime</span><span class="p">.</span><span class="nx">getDate</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">dateTime</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span> <span class="o">+</span> 
              <span class="s2">&quot; at &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">hours</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nx">minutes</span> <span class="o">+</span> <span class="nx">ampm</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">relativeTime</span><span class="p">(</span><span class="nx">parsedDate</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">relativeTo</span> <span class="o">=</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">delta</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">((</span><span class="nx">relativeTo</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">-</span> <span class="nx">parsedDate</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">);</span>
    <span class="nx">delta</span> <span class="o">=</span> <span class="nx">delta</span> <span class="o">+</span> <span class="p">(</span><span class="nx">relativeTo</span><span class="p">.</span><span class="nx">getTimezoneOffset</span><span class="p">()</span> <span class="o">*</span> <span class="mi">60</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">delta</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">)</span> <span class="nx">r</span> <span class="o">=</span> <span class="s1">&#39;a minute ago&#39;</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">delta</span> <span class="o">&lt;</span> <span class="mi">120</span><span class="p">)</span>  <span class="nx">r</span> <span class="o">=</span> <span class="s1">&#39;couple of minutes ago&#39;</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">delta</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">45</span><span class="o">*</span><span class="mi">60</span><span class="p">))</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">delta</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)).</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; minutes ago&#39;</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">delta</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">90</span><span class="o">*</span><span class="mi">60</span><span class="p">))</span> <span class="nx">r</span> <span class="o">=</span> <span class="s1">&#39;an hour ago&#39;</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">delta</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="p">))</span> <span class="nx">r</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">delta</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">)).</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; hours ago&#39;</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">delta</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">48</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="p">))</span> <span class="nx">r</span> <span class="o">=</span> <span class="s1">&#39;1 day ago&#39;</span><span class="p">;</span>
    <span class="k">else</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">delta</span> <span class="o">/</span> <span class="mi">86400</span><span class="p">)).</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; days ago&#39;</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">parseDateString</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h2>API helpers</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p><code>prepareSettings</code> uses <code>jQuery.extend</code> to merge three settings objects in
increasing order of priority. </p>

<ul>
<li><code>optionsDefault</code> provides a default set</li>
<li><code>optionsOverride</code> holds settings the user optionally specified when consuming Soliloquy</li>
<li><code>settingsInternal</code> holds the non-overridable internal settings used to call the API,
parse the data and render the output.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">prepareSettings</span><span class="p">(</span><span class="nx">optionsDefault</span><span class="p">,</span> <span class="nx">optionsOverride</span><span class="p">,</span> <span class="nx">settingsInternal</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">settings</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">soliloquy</span><span class="p">.</span><span class="nx">optionsGlobal</span><span class="p">,</span> <span class="nx">optionsDefault</span><span class="p">);</span>
    <span class="nx">settings</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">settings</span><span class="p">,</span> <span class="nx">optionsOverride</span><span class="p">);</span>
    <span class="nx">settings</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">settings</span><span class="p">,</span> <span class="nx">settingsInternal</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">settings</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p><code>apiCall</code> handles API calls for every solo by acting on its <code>settings</code> object</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">apiCall</span><span class="p">(</span><span class="nx">settings</span><span class="p">,</span> <span class="nx">jq</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Populate the <code>api</code> string with dynamic values</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">settings</span><span class="p">.</span><span class="nx">api</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">supplant</span><span class="p">(</span><span class="nx">settings</span><span class="p">);</span> </pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Append callback for JSONP if not present</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;callback&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">api</span> <span class="o">+=</span> <span class="s2">&quot;&amp;callback=?&quot;</span><span class="p">;</span> <span class="p">}</span>
  </pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Retrive data from the API</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">api</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Act upon every object the user selected (even though this will almost always be one object)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="nx">jq</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> 
        <span class="k">if</span> <span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">dataHandler</span><span class="p">)</span> <span class="p">{</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">dataHandler</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">settings</span><span class="p">,</span> <span class="nx">jq</span><span class="p">);</span> <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span> <span class="nx">handleData</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">settings</span><span class="p">,</span> <span class="nx">jq</span><span class="p">);</span> <span class="p">}</span> 
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">handleData</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">settings</span><span class="p">,</span> <span class="nx">jq</span><span class="p">){</span> <span class="c1">// GENERIC</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">item</span><span class="p">){</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">jq</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">postBuilder</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">settings</span><span class="p">));</span>
    <span class="p">});</span>
  <span class="p">}</span>
  
    </pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h1>Post builders</h1>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">buildTwitterPost</span><span class="p">(</span><span class="nx">post</span><span class="p">,</span> <span class="nx">settings</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="s2">&quot;&lt;div class=&#39;twitter post&#39;&gt;&quot;</span><span class="p">;</span>
    <span class="nx">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;span class=&#39;screen-name&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">post</span><span class="p">.</span><span class="nx">user</span><span class="p">[</span><span class="s1">&#39;screen_name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/span&gt; &quot;</span><span class="p">;</span>
    <span class="nx">html</span> <span class="o">+=</span> <span class="nx">processPost</span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">text</span><span class="p">);</span>
    
    <span class="kd">var</span> <span class="nx">values</span> <span class="o">=</span> <span class="nx">post</span><span class="p">.</span><span class="nx">created_at</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">);</span>
    <span class="nx">timeValue</span> <span class="o">=</span> <span class="nx">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nx">values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nx">values</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nx">values</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">parsedDate</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">timeValue</span><span class="p">);</span>
    
    <span class="nx">html</span> <span class="o">+=</span> <span class="s2">&quot; &lt;span class=&#39;created-at&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">buildDateString</span><span class="p">(</span><span class="nx">parsedDate</span><span class="p">,</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">relativeDates</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&lt;/span&gt;&quot;</span><span class="p">;</span>
    <span class="nx">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">html</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">buildLastfmPost</span><span class="p">(</span><span class="nx">post</span><span class="p">,</span> <span class="nx">settings</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="s2">&quot;&lt;div class=&#39;lastfm post&#39;&gt;&quot;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">settings</span><span class="p">)</span> <span class="nx">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;span class=&#39;screen-name&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">username</span> <span class="o">+</span> <span class="s2">&quot;&lt;/span&gt; &quot;</span><span class="p">;</span>
    <span class="nx">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;span class=&#39;lastfm_artist&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">post</span><span class="p">.</span><span class="nx">artist</span><span class="p">[</span><span class="s1">&#39;#text&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/span&gt; &amp;ndash; &quot;</span><span class="p">;</span>
    <span class="nx">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;span class=&#39;lastfm_track&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">post</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;&lt;/span&gt;&quot;</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">dateString</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">labelListeningNow</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">parsedDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">date</span><span class="p">[</span><span class="s1">&#39;#text&#39;</span><span class="p">]);</span>
      <span class="nx">dateString</span> <span class="o">=</span> <span class="nx">buildDateString</span><span class="p">(</span><span class="nx">parsedDate</span><span class="p">,</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">relativeDates</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">html</span> <span class="o">+=</span> <span class="s2">&quot; &lt;span class=&#39;created-at&#39;&gt;&quot;</span> <span class="o">+</span>  <span class="nx">dateString</span> <span class="o">+</span> <span class="s2">&quot;&lt;/span&gt;&quot;</span><span class="p">;</span>
    <span class="nx">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">html</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">buildFacebookPost</span><span class="p">(</span><span class="nx">post</span><span class="p">,</span> <span class="nx">settings</span><span class="p">)</span> <span class="p">{</span>
    </pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Parse date</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">rawDate</span> <span class="o">=</span> <span class="nx">post</span><span class="p">.</span><span class="nx">created_time</span><span class="p">;</span>
    <span class="nx">parsedDate</span> <span class="o">=</span> <span class="nx">parseFacebookDate</span><span class="p">(</span><span class="nx">rawDate</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">dateString</span> <span class="o">=</span> <span class="nx">buildDateString</span><span class="p">(</span><span class="nx">parsedDate</span><span class="p">,</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">relativeDates</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">thumbnail</span> <span class="o">=</span> <span class="s2">&quot;http://graph.facebook.com/&quot;</span> <span class="o">+</span> <span class="nx">post</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;/picture&quot;</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=&quot;facebook post&quot;&gt;&#39;</span><span class="p">;</span>
    <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;span class=&quot;thumbnail&quot;&gt;&lt;img src=&quot;&#39;</span> <span class="o">+</span> <span class="nx">thumbnail</span> <span class="o">+</span> <span class="s1">&#39;&quot; alt=&quot;&#39;</span> <span class="o">+</span> <span class="nx">post</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;&quot; /&gt;&lt;/span&gt;&#39;</span><span class="p">;</span>
    <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;div class=&quot;post_content&quot;&gt;&#39;</span><span class="p">;</span>
      <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;span class=&quot;screen-name&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">post</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;&lt;/span&gt; &#39;</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;status&quot;</span><span class="p">){</span>
        <span class="nx">html</span> <span class="o">+=</span> <span class="nx">processPost</span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;link&quot;</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span> <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;span class=&quot;message&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">processPost</span><span class="p">(</span><span class="nx">parseFacebookNewlines</span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">message</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;&lt;/span&gt;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">picture</span><span class="p">){</span>
          <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;div class=&quot;link-picture&quot;&gt;&lt;a href=&quot;&#39;</span> <span class="o">+</span> <span class="nx">post</span><span class="p">.</span><span class="nx">link</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&lt;img src=&quot;&#39;</span> <span class="o">+</span> <span class="nx">post</span><span class="p">.</span><span class="nx">picture</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&lt;/a&gt;&lt;/div&gt;&#39;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">link</span> <span class="o">&amp;&amp;</span> <span class="nx">post</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;div class=&quot;link-content&quot;&gt;&lt;a href=&quot;&#39;</span> <span class="o">+</span> <span class="nx">post</span><span class="p">.</span><span class="nx">link</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">post</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;&lt;/a&gt;&lt;span class=&quot;description&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">post</span><span class="p">.</span><span class="nx">description</span> <span class="o">+</span> <span class="s1">&#39;&lt;/span&gt;&lt;/div&gt;&#39;</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;photo&quot;</span><span class="p">){</span>
        <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;span class=&quot;photo&quot;&gt;&#39;</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span> <span class="nx">html</span> <span class="o">+=</span> <span class="nx">post</span><span class="p">.</span><span class="nx">message</span><span class="p">;</span>
          <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;span class=&quot;picture&quot;&gt;&#39;</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">link</span><span class="p">)</span> <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;a href=&quot;&#39;</span> <span class="o">+</span> <span class="nx">post</span><span class="p">.</span><span class="nx">link</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&#39;</span><span class="p">;</span>
            <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;img src=&quot;&#39;</span> <span class="o">+</span> <span class="nx">post</span><span class="p">.</span><span class="nx">picture</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&#39;</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">link</span><span class="p">)</span> <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/a&gt;&#39;</span><span class="p">;</span>
          <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/span&gt;&#39;</span><span class="p">;</span>
        <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/span&#39;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39; &lt;span class=&quot;created-at&quot;&gt;&#39;</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">icon</span><span class="p">)</span> <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;img src=&quot;&#39;</span> <span class="o">+</span> <span class="nx">post</span><span class="p">.</span><span class="nx">icon</span> <span class="o">+</span> <span class="s1">&#39;&quot; /&gt; &#39;</span><span class="p">;</span>
      <span class="nx">html</span> <span class="o">+=</span> <span class="nx">dateString</span> <span class="o">+</span> <span class="s2">&quot;&lt;/span&gt;&quot;</span><span class="p">;</span>


      <span class="k">if</span> <span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">comments</span> <span class="o">&amp;&amp;</span> <span class="nx">$</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">comments</span><span class="p">.</span><span class="nx">data</span><span class="p">)){</span>
        <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;div class=&quot;comments&quot;&gt;&#39;</span><span class="p">;</span>
          <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">comments</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">comment</span><span class="p">){</span>
            
            <span class="kd">var</span> <span class="nx">commenterThumb</span> <span class="o">=</span> <span class="s2">&quot;http://graph.facebook.com/&quot;</span> <span class="o">+</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;/picture?type=square&quot;</span><span class="p">;</span>

            <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;div class=&quot;comment&quot;&gt;&#39;</span><span class="p">;</span>
              <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;span class=&quot;picture&quot;&gt;&#39;</span><span class="p">;</span>
                <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;img src=&quot;&#39;</span> <span class="o">+</span> <span class="nx">commenterThumb</span> <span class="o">+</span> <span class="s1">&#39;&quot; /&gt;&#39;</span><span class="p">;</span>
              <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/span&gt;&#39;</span><span class="p">;</span>
              <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;span class=&quot;comment-content&quot;&gt;&#39;</span><span class="p">;</span>
                <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;span class=&quot;screen-name&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;&lt;/span&gt; &#39;</span><span class="p">;</span>
                <span class="nx">html</span> <span class="o">+=</span> <span class="nx">processPost</span><span class="p">(</span><span class="nx">parseFacebookNewlines</span><span class="p">(</span><span class="nx">comment</span><span class="p">.</span><span class="nx">message</span><span class="p">));</span>
              <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/span&gt;&#39;</span><span class="p">;</span>
              <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39; &lt;span class=&quot;created-at&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">dateString</span> <span class="o">+</span> <span class="s2">&quot;&lt;/span&gt;&quot;</span><span class="p">;</span>
          

            <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
          <span class="p">});</span>
        <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
      <span class="p">}</span>
      

    <span class="nx">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">;</span>
    <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">html</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">parseFacebookNewlines</span><span class="p">(</span><span class="nx">message</span><span class="p">){</span>
    <span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\n/g</span><span class="p">,</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">parseFacebookDate</span><span class="p">(</span><span class="nx">rawDate</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">year</span> <span class="o">=</span> <span class="nx">rawDate</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">month</span> <span class="o">=</span> <span class="nx">rawDate</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">day</span> <span class="o">=</span> <span class="nx">rawDate</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">hour</span> <span class="o">=</span> <span class="nx">rawDate</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">minute</span> <span class="o">=</span> <span class="nx">rawDate</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">second</span> <span class="o">=</span> <span class="nx">rawDate</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">year</span><span class="p">,</span> <span class="nx">month</span><span class="p">,</span> <span class="nx">day</span><span class="p">,</span> <span class="nx">hour</span><span class="p">,</span> <span class="nx">minute</span><span class="p">,</span> <span class="nx">second</span><span class="p">);</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h1>Solos</h1>

<p>Soliloquy uses a declarative data structure to hold each data source, or "solo". Each solo consists
of several properties that tell Soliloquy where to fetch data, how to parse it, and how to
render it into HTML. It provides an options interface to allow consumers of Soliloquy to
customize their API calls. For example, the twitter solo provides a "posts" property that allows
a user to specify how many twitter posts they'd like to retrieve.</p>

<p>The declarative structure makes it quick and easy to add other APIs to Soliloquy. To contribute,
use the existing solos as an example, test, and send a pull request.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">solos</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <h2>Facebook</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">solos</span><span class="p">[</span><span class="s2">&quot;facebook&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">settings</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">api</span><span class="o">:</span> <span class="s1">&#39;https://graph.facebook.com/{username}/feed?limit={posts}&#39;</span><span class="p">,</span>
      <span class="nx">postBuilder</span><span class="o">:</span> <span class="nx">buildFacebookPost</span><span class="p">,</span>
      <span class="nx">dataHandler</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">settings</span><span class="p">,</span> <span class="nx">jq</span><span class="p">){</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">item</span><span class="p">){</span>
          <span class="nx">$</span><span class="p">(</span><span class="nx">jq</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">postBuilder</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">settings</span><span class="p">));</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <h2>Twitter</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">solos</span><span class="p">[</span><span class="s2">&quot;twitter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">settings</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">api</span><span class="o">:</span> <span class="s1">&#39;http://twitter.com/status/user_timeline/{username}.json?count={posts}&#39;</span><span class="p">,</span>
      <span class="nx">postBuilder</span><span class="o">:</span> <span class="nx">buildTwitterPost</span>
    <span class="p">},</span>
    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
      <span class="nx">posts</span><span class="o">:</span> <span class="mi">10</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <h2>Twitter lists</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">solos</span><span class="p">[</span><span class="s2">&quot;twitterList&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">settings</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">api</span><span class="o">:</span> <span class="s1">&#39;http://api.twitter.com/1/{username}/lists/{listname}/statuses.json?per_page={posts}&#39;</span><span class="p">,</span>
      <span class="nx">postBuilder</span><span class="o">:</span> <span class="nx">buildTwitterPost</span>
    <span class="p">},</span>
    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
      <span class="nx">listname</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h2>Last.fm</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">solos</span><span class="p">[</span><span class="s2">&quot;lastfm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">settings</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">api</span><span class="o">:</span> <span class="s1">&#39;http://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&amp;user={username}&amp;api_key={apiKey}&amp;limit={tracks}&amp;format=json&#39;</span><span class="p">,</span>
      <span class="nx">postBuilder</span><span class="o">:</span> <span class="nx">buildLastfmPost</span><span class="p">,</span>
      <span class="nx">dataHandler</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">handleLastfmData</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">settings</span><span class="p">,</span> <span class="nx">jq</span><span class="p">){</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">recenttracks</span><span class="p">.</span><span class="nx">track</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">item</span><span class="p">){</span>
          <span class="nx">$</span><span class="p">(</span><span class="nx">jq</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">postBuilder</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">settings</span><span class="p">));</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">labelListeningNow</span><span class="o">:</span> <span class="s1">&#39;now playing&#39;</span><span class="p">,</span>
      <span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
      <span class="nx">apiKey</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>HELPERS</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 